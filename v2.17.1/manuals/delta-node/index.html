<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Delta node · RxInfer.jl</title><meta name="title" content="Delta node · RxInfer.jl"/><meta property="og:title" content="Delta node · RxInfer.jl"/><meta property="twitter:title" content="Delta node · RxInfer.jl"/><meta name="description" content="Documentation for RxInfer.jl."/><meta property="og:description" content="Documentation for RxInfer.jl."/><meta property="twitter:description" content="Documentation for RxInfer.jl."/><meta property="og:url" content="https://reactivebayes.github.io/RxInfer.jl/manuals/delta-node/"/><meta property="twitter:url" content="https://reactivebayes.github.io/RxInfer.jl/manuals/delta-node/"/><link rel="canonical" href="https://reactivebayes.github.io/RxInfer.jl/manuals/delta-node/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/theme.css" rel="stylesheet" type="text/css"/><link href="../../assets/header.css" rel="stylesheet" type="text/css"/><script src="../../assets/header.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="RxInfer.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="RxInfer.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">RxInfer.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">User guide</span><ul><li><a class="tocitem" href="../getting-started/">Getting started</a></li><li><a class="tocitem" href="../comparison/">RxInfer.jl vs. Others</a></li><li><a class="tocitem" href="../model-specification/">Model specification</a></li><li><a class="tocitem" href="../constraints-specification/">Constraints specification</a></li><li><a class="tocitem" href="../meta-specification/">Meta specification</a></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox"/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">Inference specification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../inference/overview/">Overview</a></li><li><a class="tocitem" href="../inference/infer/">Static vs Streamline inference</a></li><li><a class="tocitem" href="../inference/postprocess/">Inference results postprocessing</a></li><li><a class="tocitem" href="../inference/manual/">Manual inference specification</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">Inference customization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../custom-node/">Defining a custom node and rules</a></li></ul></li><li><a class="tocitem" href="../understanding-why-to-initialize-messages/">Messages initialization</a></li><li><a class="tocitem" href="../debugging/">Debugging</a></li><li class="is-active"><a class="tocitem" href>Delta node</a><ul class="internal"><li><a class="tocitem" href="#Features-and-Supported-Inference-Scenarios"><span>Features and Supported Inference Scenarios</span></a></li><li><a class="tocitem" href="#Gaussian-Case"><span>Gaussian Case</span></a></li><li><a class="tocitem" href="#Exponential-Family-Case"><span>Exponential Family Case</span></a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/functional-forms/">Built-in functional form constraints</a></li><li><a class="tocitem" href="../../library/model-specification/">Model specification</a></li><li><a class="tocitem" href="../../library/bethe-free-energy/">Bethe Free Energy</a></li><li><a class="tocitem" href="../../library/exported-methods/">Exported methods</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/overview/">Overview</a></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Basic examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/basic_examples/overview/">Overview</a></li><li><a class="tocitem" href="../../examples/basic_examples/Coin Toss Model/">Coin toss model (Beta-Bernoulli)</a></li><li><a class="tocitem" href="../../examples/basic_examples/Bayesian Linear Regression Tutorial/">Bayesian Linear Regression Tutorial</a></li><li><a class="tocitem" href="../../examples/basic_examples/Kalman filtering and smoothing/">Kalman filtering and smoothing</a></li><li><a class="tocitem" href="../../examples/basic_examples/Predicting Bike Rental Demand/">Predicting Bike Rental Demand</a></li><li><a class="tocitem" href="../../examples/basic_examples/Hidden Markov Model/">How to train your Hidden Markov Model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Advanced examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/advanced_examples/overview/">Overview</a></li><li><a class="tocitem" href="../../examples/advanced_examples/Active Inference Mountain car/">Active Inference Mountain car</a></li><li><a class="tocitem" href="../../examples/advanced_examples/Advanced Tutorial/">Advanced Tutorial</a></li><li><a class="tocitem" href="../../examples/advanced_examples/Assessing People Skills/">Assessing People’s Skills</a></li><li><a class="tocitem" href="../../examples/advanced_examples/Chance Constraints/">Chance-Constrained Active Inference</a></li><li><a class="tocitem" href="../../examples/advanced_examples/Conjugate-Computational Variational Message Passing/">Conjugate-Computational Variational Message Passing (CVI)</a></li><li><a class="tocitem" href="../../examples/advanced_examples/Global Parameter Optimisation/">Global Parameter Optimisation</a></li><li><a class="tocitem" href="../../examples/advanced_examples/GP Regression by SSM/">Solve GP regression by SDE</a></li><li><a class="tocitem" href="../../examples/advanced_examples/Infinite Data Stream/">Infinite Data Stream</a></li><li><a class="tocitem" href="../../examples/advanced_examples/Nonlinear Sensor Fusion/">Nonlinear Sensor Fusion</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Problem specific</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/problem_specific/overview/">Overview</a></li><li><a class="tocitem" href="../../examples/problem_specific/Autoregressive Models/">Autoregressive Models</a></li><li><a class="tocitem" href="../../examples/problem_specific/Gamma Mixture/">Gamma Mixture Model</a></li><li><a class="tocitem" href="../../examples/problem_specific/Gaussian Mixture/">Gaussian Mixture</a></li><li><a class="tocitem" href="../../examples/problem_specific/Hierarchical Gaussian Filter/">Hierarchical Gaussian Filter</a></li><li><a class="tocitem" href="../../examples/problem_specific/Invertible Neural Network Tutorial/">Invertible neural networks: a tutorial</a></li><li><a class="tocitem" href="../../examples/problem_specific/Probit Model (EP)/">Probit Model (EP)</a></li><li><a class="tocitem" href="../../examples/problem_specific/RTS vs BIFM Smoothing/">RTS vs BIFM Smoothing</a></li><li><a class="tocitem" href="../../examples/problem_specific/Simple Nonlinear Node/">Simple Nonlinear Node</a></li><li><a class="tocitem" href="../../examples/problem_specific/Universal Mixtures/">Universal Mixtures</a></li></ul></li><li><a class="tocitem" href="../../contributing/external-examples/">External examples</a></li></ul></li><li><span class="tocitem">Contributing</span><ul><li><a class="tocitem" href="../../contributing/guide/">Contribution guide</a></li><li><a class="tocitem" href="../../contributing/guidelines/">Contribution guidelines</a></li><li><a class="tocitem" href="../../contributing/new-documentation/">Contributing to the documentation</a></li><li><a class="tocitem" href="../../contributing/new-example/">Contributing to the examples</a></li><li><a class="tocitem" href="../../contributing/new-release/">Publishing a new release</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User guide</a></li><li class="is-active"><a href>Delta node</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Delta node</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ReactiveBayes/RxInfer.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ReactiveBayes/RxInfer.jl/blob/main/docs/src/manuals/delta-node.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="delta-node-manual"><a class="docs-heading-anchor" href="#delta-node-manual">Delta node manual</a><a id="delta-node-manual-1"></a><a class="docs-heading-anchor-permalink" href="#delta-node-manual" title="Permalink"></a></h1><p>RxInfer.jl offers a comprehensive set of stochastic nodes, with a primary emphasis on distributions from the exponential family and its associated compositions, such as Gaussian with controlled variance (GCV) or autoregressive (AR) nodes. The <code>DeltaNode</code> stands out in this package, representing a deterministic transformation of either a single random variable or a group of them. This guide provides insights into the <code>DeltaNode</code> and its functionalities.</p><h2 id="Features-and-Supported-Inference-Scenarios"><a class="docs-heading-anchor" href="#Features-and-Supported-Inference-Scenarios">Features and Supported Inference Scenarios</a><a id="Features-and-Supported-Inference-Scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Features-and-Supported-Inference-Scenarios" title="Permalink"></a></h2><p>The delta node has several approximation methods for performing probabilistic inference. The desired approximation method depends on the nodes connected to the delta node. We differentiate the following deterministic transformation scenarios:</p><ol><li><strong>Gaussian Nodes</strong>: For delta nodes linked to strictly multivariate or univariate Gaussian distributions, the recommended methods are Linearization or Unscented transforms.</li><li><strong>Exponential Family Nodes</strong>: For the delta node connected to nodes from the exponential family, the CVI (Conjugate Variational Inference) is the method of choice.</li><li><strong>Stacking Delta Nodes</strong>: For scenarios where delta nodes are stacked, either Linearization or Unscented transforms are suitable.</li></ol><p>The table below summarizes the features of the delta node in RxInfer.jl, categorized by the approximation method:</p><table><tr><th style="text-align: right">Methods</th><th style="text-align: right">Gaussian Nodes</th><th style="text-align: right">Exponential Family Nodes</th><th style="text-align: right">Stacking Delta Nodes</th></tr><tr><td style="text-align: right">Linearization</td><td style="text-align: right">✓</td><td style="text-align: right">✗</td><td style="text-align: right">✓</td></tr><tr><td style="text-align: right">Unscented</td><td style="text-align: right">✓</td><td style="text-align: right">✗</td><td style="text-align: right">✓</td></tr><tr><td style="text-align: right">CVI</td><td style="text-align: right">✓</td><td style="text-align: right">✓</td><td style="text-align: right">✗</td></tr></table><h2 id="Gaussian-Case"><a class="docs-heading-anchor" href="#Gaussian-Case">Gaussian Case</a><a id="Gaussian-Case-1"></a><a class="docs-heading-anchor-permalink" href="#Gaussian-Case" title="Permalink"></a></h2><p>In the context of Gaussian distributions, we recommend either the <code>Linearization</code> or <code>Unscented</code> method for delta node approximation. The <code>Linearization</code> method provides a first-order approximation, while the <code>Unscented</code> method delivers a more precise second-order approximation. It&#39;s worth noting that while the <code>Unscented</code> method is more accurate, it may require hyper-parameters tuning.</p><p>For clarity, consider the following example:</p><pre><code class="language-julia hljs">using RxInfer

@model function delta_node_example()
    z = datavar(Float64)
    x ~ Normal(mean=0.0, var=1.0)
    y ~ tanh(x)
    z ~ Normal(mean=y, var=1.0)
end</code></pre><p>To perform inference on this model, designate the approximation method for the delta node (here, the <code>tanh</code> function) using the <code>@meta</code> specification:</p><pre><code class="language-julia hljs">delta_meta = @meta begin
    tanh() -&gt; Linearization()
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta specification:
  tanh() -&gt; Linearization()
Options:
  warn = true</code></pre><p>or</p><pre><code class="language-julia hljs">delta_meta = @meta begin
    tanh() -&gt; Unscented()
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta specification:
  tanh() -&gt; Unscented{Float64, Float64, Float64, Nothing}(0.001, 2.0, 0.0, nothing)
Options:
  warn = true</code></pre><p>For a deeper understanding of the <code>Unscented</code> method and its parameters, consult the docstrings.</p><p>Given the invertibility of <code>tanh</code>, indicating its inverse function can optimize the inference procedure:</p><pre><code class="language-julia hljs">delta_meta = @meta begin
    tanh() -&gt; DeltaMeta(method = Linearization(), inverse = atanh)
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta specification:
  tanh() -&gt; DeltaMeta{Linearization, typeof(atanh)}(Linearization(), atanh)
Options:
  warn = true</code></pre><p>To execute the inference procedure:</p><pre><code class="language-julia hljs">infer(model = delta_node_example(), meta=delta_meta, data = (z = 1.0,))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Inference results:
  Posteriors       | available for (y, x)
</code></pre><p>This methodology is consistent even when the delta node is associated with multiple nodes. For instance:</p><pre><code class="language-julia hljs">f(x, g) = x*tanh(g)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">f (generic function with 1 method)</code></pre><pre><code class="language-julia hljs">@model function delta_node_example()
    z = datavar(Float64)
    x ~ Normal(mean=1.0, var=1.0)
    g ~ Normal(mean=1.0, var=1.0)
    y ~ f(x, g)
    z ~ Normal(mean=y, var=0.1)
end</code></pre><p>The corresponding meta specification is:</p><pre><code class="language-julia hljs">delta_meta = @meta begin
    f() -&gt; DeltaMeta(method = Linearization())
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta specification:
  f() -&gt; DeltaMeta{Linearization, Nothing}(Linearization(), nothing)
Options:
  warn = true</code></pre><p>or simply</p><pre><code class="language-julia hljs">delta_meta = @meta begin
    f() -&gt; Linearization()
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta specification:
  f() -&gt; Linearization()
Options:
  warn = true</code></pre><p>If specific functions outline the backward relation of variables within the <code>f</code> function, you can provide a tuple of inverse functions in the order of the variables:</p><pre><code class="language-julia hljs">delta_meta = @meta begin 
    f() -&gt; DeltaMeta(method = Linearization(), inverse=(f_back_x, f_back_g))
end</code></pre><h2 id="Exponential-Family-Case"><a class="docs-heading-anchor" href="#Exponential-Family-Case">Exponential Family Case</a><a id="Exponential-Family-Case-1"></a><a class="docs-heading-anchor-permalink" href="#Exponential-Family-Case" title="Permalink"></a></h2><p>When the delta node is associated with nodes from the exponential family (excluding Gaussians), the <code>Linearization</code> and <code>Unscented</code> methods are not applicable. In such cases, the CVI (Conjugate Variational Inference) is available. Here&#39;s a modified example:</p><pre><code class="language-julia hljs">using RxInfer

@model function delta_node_example1()
    z = datavar(Float64)
    x ~ Gamma(shape=1.0, rate=1.0)
    y ~ tanh(x)
    z ~ Bernoulli(y)
end</code></pre><p>The corresponding meta specification can be represented as:</p><pre><code class="language-julia hljs">using StableRNGs
using Optimisers

delta_meta = @meta begin
    tanh() -&gt; DeltaMeta(method = CVI(StableRNG(42), 100, 100, Optimisers.Descent(0.01)))
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Meta specification:
  tanh() -&gt; DeltaMeta{ProdCVI{StableRNGs.LehmerRNG, Optimisers.Descent{Float64}, ForwardDiffGrad{0}, true}, Nothing}(ProdCVI{StableRNGs.LehmerRNG, Optimisers.Descent{Float64}, ForwardDiffGrad{0}, true}(StableRNGs.LehmerRNG(state=0x00000000000000000000000000000055), 100, 100, Optimisers.Descent{Float64}(0.01), ForwardDiffGrad{0}(), 1, Val{true}(), true), nothing)
Options:
  warn = true</code></pre><p>Consult the <code>ProdCVI</code> docstrings for a detailed explanation of these parameters.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../debugging/">« Debugging</a><a class="docs-footer-nextpage" href="../../library/functional-forms/">Built-in functional form constraints »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 9 April 2024 09:32">Tuesday 9 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
