<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Understanding Rules · RxInfer.jl</title><meta name="title" content="Understanding Rules · RxInfer.jl"/><meta property="og:title" content="Understanding Rules · RxInfer.jl"/><meta property="twitter:title" content="Understanding Rules · RxInfer.jl"/><meta name="description" content="Julia package for automated Bayesian inference on a factor graph with reactive message passing"/><meta property="og:description" content="Julia package for automated Bayesian inference on a factor graph with reactive message passing"/><meta property="twitter:description" content="Julia package for automated Bayesian inference on a factor graph with reactive message passing"/><meta property="og:url" content="https://docs.rxinfer.com/stable/manuals/rules_and_nodes/"/><meta property="twitter:url" content="https://docs.rxinfer.com/stable/manuals/rules_and_nodes/"/><link rel="canonical" href="https://docs.rxinfer.com/stable/manuals/rules_and_nodes/"/><script async src="https://www.googletagmanager.com/gtag/js?id=G-X4PH160GMF"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X4PH160GMF', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/theme.css" rel="stylesheet" type="text/css"/><link href="../../assets/header.css" rel="stylesheet" type="text/css"/><script src="../../assets/header.js"></script><script src="../../assets/chat.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/><meta name="keywords" content="Julia, Bayesian inference, factor graph, message passing, probabilistic programming, reactive programming, RxInfer">
<link rel="sitemap" type="application/xml" title="Sitemap" href="https://docs.rxinfer.com/stable/sitemap.xml"></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="RxInfer.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="RxInfer.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">User guide</span><ul><li><a class="tocitem" href="../getting-started/">Getting started</a></li><li><a class="tocitem" href="../comparison/">RxInfer.jl vs. Others</a></li><li><a class="tocitem" href="../how-to-use-rxinfer-from-python/">Using RxInfer from Python</a></li><li><a class="tocitem" href="../model-specification/">Model specification</a></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Variational inference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../variational/bethe-free-energy/">Bethe Free Energy</a></li><li><a class="tocitem" href="../variational/constraints-specification/">Constraints specification</a></li><li><a class="tocitem" href="../variational/functional-forms/">Functional form constraints</a></li></ul></li><li class="is-active"><a class="tocitem" href>Understanding Rules</a><ul class="internal"><li><a class="tocitem" href="#Visualizing-a-Rule"><span>Visualizing a Rule</span></a></li><li><a class="tocitem" href="#The-Analogy:-Telephone-vs.-Surveys"><span>The Analogy: Telephone vs. Surveys</span></a></li><li><a class="tocitem" href="#implementing-a-custom-node"><span>Implementing a Custom Node</span></a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">Inference specification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../inference/overview/">Overview</a></li><li><a class="tocitem" href="../inference/static/">Static inference</a></li><li><a class="tocitem" href="../inference/streamlined/">Streamline inference</a></li><li><a class="tocitem" href="../inference/static-vs-streamlined/">Static vs. Streamlined</a></li><li><a class="tocitem" href="../inference/initialization/">Initialization</a></li><li><a class="tocitem" href="../inference/meta-specification/">Meta specification</a></li><li><a class="tocitem" href="../inference/autoupdates/">Auto-updates</a></li><li><a class="tocitem" href="../inference/delta-node/">Deterministic nodes</a></li><li><a class="tocitem" href="../inference/nonconjugate/">Non-conjugate inference</a></li><li><a class="tocitem" href="../inference/undefinedrules/">Undefined message update rules</a></li><li><a class="tocitem" href="../inference/postprocess/">Inference results postprocessing</a></li><li><a class="tocitem" href="../inference/create-node/">Creating your own custom nodes</a></li></ul></li><li><a class="tocitem" href="../performance-tips/">Performance Tips</a></li><li><a class="tocitem" href="../faq/">FAQ</a></li><li><a class="tocitem" href="../debugging/">Debugging</a></li><li><a class="tocitem" href="../session_summary/">Session summary</a></li><li><a class="tocitem" href="../telemetry/">Sharing sessions &amp; telemetry</a></li><li><a class="tocitem" href="../migration-guide-v2-v3/">Migration from v2 to v3</a></li><li><input class="collapse-toggle" id="menuitem-2-14" type="checkbox"/><label class="tocitem" for="menuitem-2-14"><span class="docs-label">Sharp bits of RxInfer</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../sharpbits/overview/">Overview</a></li><li><a class="tocitem" href="../sharpbits/rule-not-found/">Rule Not Found Error</a></li><li><a class="tocitem" href="../sharpbits/stack-overflow-inference/">Stack Overflow in Message Computations</a></li><li><a class="tocitem" href="../sharpbits/usage-colon-equality/">Using <code>=</code> instead of <code>:=</code> for deterministic nodes</a></li></ul></li></ul></li><li><a class="tocitem" href="../../examples/overview/">Examples</a></li><li><span class="tocitem">Contributing</span><ul><li><a class="tocitem" href="../../contributing/guide/">Contribution guide</a></li><li><a class="tocitem" href="../../contributing/guidelines/">Contribution guidelines</a></li><li><a class="tocitem" href="../../contributing/new-documentation/">Contributing to the documentation</a></li><li><a class="tocitem" href="../../contributing/new-example/">Contributing to the examples</a></li><li><a class="tocitem" href="../../contributing/exported-methods/">Exported methods</a></li><li><a class="tocitem" href="../../contributing/new-release/">Publishing a new release</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User guide</a></li><li class="is-active"><a href>Understanding Rules</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Understanding Rules</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ReactiveBayes/RxInfer.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ReactiveBayes/RxInfer.jl/blob/main/docs/src/manuals/rules_and_nodes.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="what-is-a-rule"><a class="docs-heading-anchor" href="#what-is-a-rule">Understanding Rules: The Mechanics of Message Passing</a><a id="what-is-a-rule-1"></a><a class="docs-heading-anchor-permalink" href="#what-is-a-rule" title="Permalink"></a></h1><p>In RxInfer, a Rule is a computational unit that defines how information flows across a specific edge of your factor graph.</p><p>Users often ask: &quot;Why do some rules take <code>m_x</code> as input, while others take <code>q_x</code>? And what about <code>q_xy</code>?&quot;</p><p>The answer lies in the variational constraints you place on your model. Depending on whether you are running unconstrained Belief Propagation or Mean-Field Variational Inference, the nodes in your graph need to perform different mathematical operations, which requires different types of input data.</p><h2 id="Visualizing-a-Rule"><a class="docs-heading-anchor" href="#Visualizing-a-Rule">Visualizing a Rule</a><a id="Visualizing-a-Rule-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing-a-Rule" title="Permalink"></a></h2><p>Consider a simple factor node <span>$f$</span> connecting an input variable <span>$y$</span> to an output variable <span>$x$</span>. When the node needs to send a message to <span>$x$</span>, the Rule defines how to transform the incoming information from <span>$y$</span> into that outgoing message.</p><div class="mermaid">graph LR
    subgraph &quot;The Local Neighborhood&quot;
    y((y)) -- &quot;Incoming Information&quot; --&gt; factor[Factor Node f]
    factor -- &quot;Outgoing Message&quot; --&gt; x((x))
    end

    style factor fill:#f9f,stroke:#333,stroke-width:2px
    style y fill:#fff,stroke:#333
    style x fill:#fff,stroke:#333</div><p>The &quot;Rule&quot; is the logic inside the pink box. It answers the question: &quot;Given what I know about <span>$y$</span>, what should I tell <span>$x$</span>?&quot;</p><h2 id="The-Analogy:-Telephone-vs.-Surveys"><a class="docs-heading-anchor" href="#The-Analogy:-Telephone-vs.-Surveys">The Analogy: Telephone vs. Surveys</a><a id="The-Analogy:-Telephone-vs.-Surveys-1"></a><a class="docs-heading-anchor-permalink" href="#The-Analogy:-Telephone-vs.-Surveys" title="Permalink"></a></h2><p>To understand which rule RxInfer needs, imagine the nodes in your graph are agents trying to learn about the world. They use different &quot;protocols&quot; to communicate based on the constraints you apply.</p><h3 id="1.-The-&quot;Telephone&quot;-Protocol-(Belief-Propagation)"><a class="docs-heading-anchor" href="#1.-The-&quot;Telephone&quot;-Protocol-(Belief-Propagation)">1. The &quot;Telephone&quot; Protocol (Belief Propagation)</a><a id="1.-The-&quot;Telephone&quot;-Protocol-(Belief-Propagation)-1"></a><a class="docs-heading-anchor-permalink" href="#1.-The-&quot;Telephone&quot;-Protocol-(Belief-Propagation)" title="Permalink"></a></h3><p><strong>Context</strong>: No constraints are applied (or the graph is a tree).</p><ul><li><strong>Input Prefix</strong>: <code>m_</code> (Incoming Message)</li><li><strong>The Logic</strong>: &quot;I don&#39;t know the final truth, but I will pass on the specific message I just received from my neighbor.&quot;</li><li><strong>The Math (Sum-Product Integral)</strong>: In exact inference, a factor node <span>$f(x, y)$</span> calculates a message towards <span>$x$</span> by integrating the factor with the incoming message from <span>$y$</span> (<span>$\vec{\mu}(y)$</span>):</li></ul><p class="math-container">\[\vec{\mu}(x) \propto \int f(x, y) \cdot \vec{\mu}(y) \, dy\]</p><ul><li><strong>Why <code>m_</code>?</strong> To solve this integral, the node only needs the &quot;incoming opinion&quot; (<span>$\vec{\mu}(y)$</span>) from the neighbor branch. It does not need the neighbor&#39;s final marginal belief.</li></ul><h3 id="2.-The-&quot;Survey&quot;-Protocol-(Variational-Message-Passing)"><a class="docs-heading-anchor" href="#2.-The-&quot;Survey&quot;-Protocol-(Variational-Message-Passing)">2. The &quot;Survey&quot; Protocol (Variational Message Passing)</a><a id="2.-The-&quot;Survey&quot;-Protocol-(Variational-Message-Passing)-1"></a><a class="docs-heading-anchor-permalink" href="#2.-The-&quot;Survey&quot;-Protocol-(Variational-Message-Passing)" title="Permalink"></a></h3><p><strong>Context</strong>: Factorization constraints are applied (e.g., Mean-Field <span>$q(x,y) = q(x)q(y)$</span>).</p><ul><li><strong>Input Prefix</strong>: <code>q_</code> (Marginal Distribution)</li><li><strong>The Logic</strong>: &quot;To minimize the global error (Free Energy), I need to calculate the average opinion (expectation) of my neighbors.&quot;</li><li><strong>The Math (Variational Expectation)</strong>: In Variational Message Passing (VMP), the update minimizes the KL-divergence. This results in an update equation based on the expectation of the log-factor:</li></ul><p class="math-container">\[\ln \vec{\mu}(x) \propto \mathbb{E}_{q(y)} \left[ \ln f(x, y) \right]\]</p><ul><li><strong>Why <code>q_</code>?</strong> To calculate an expectation <span>$\mathbb{E}_{q(y)}$</span>, the node must know the marginal distribution <span>$q(y)$</span> of the neighbor. A simple message is not enough; it needs the full summary of the neighbor&#39;s belief.</li></ul><h3 id="3.-The-&quot;Team-Report&quot;-Protocol-(Structured-Inference)"><a class="docs-heading-anchor" href="#3.-The-&quot;Team-Report&quot;-Protocol-(Structured-Inference)">3. The &quot;Team Report&quot; Protocol (Structured Inference)</a><a id="3.-The-&quot;Team-Report&quot;-Protocol-(Structured-Inference)-1"></a><a class="docs-heading-anchor-permalink" href="#3.-The-&quot;Team-Report&quot;-Protocol-(Structured-Inference)" title="Permalink"></a></h3><p><strong>Context</strong>: Structured constraints (variables are coupled in blocks).</p><ul><li><strong>Input Prefix</strong>: <code>q_ab</code> (Joint Marginal)</li><li><strong>The Logic</strong>: &quot;Variables A and B are strictly coupled. I cannot look at them separately; I need a joint report on how they relate to each other.&quot;</li><li><strong>The Math</strong>: Similar to VMP, but the expectation is taken over the joint distribution of the coupled variables:</li></ul><p class="math-container">\[\ln \vec{\mu}(x) \propto \mathbb{E}_{q(y, z)} \left[ \ln f(x, y, z) \right]\]</p><ul><li><strong>Why <code>q_yz</code>?</strong> If <span>$y$</span> and <span>$z$</span> are correlated, <span>$\mathbb{E}[y \cdot z] \neq \mathbb{E}[y]\mathbb{E}[z]$</span>. The rule needs the joint distribution to capture these correlations.</li></ul><h2 id="implementing-a-custom-node"><a class="docs-heading-anchor" href="#implementing-a-custom-node">Implementing a Custom Node</a><a id="implementing-a-custom-node-1"></a><a class="docs-heading-anchor-permalink" href="#implementing-a-custom-node" title="Permalink"></a></h2><p>Sometimes you may need to implement a custom node and its corresponding rule. This is a common task when you need to model a new distribution or a new relationship between variables. To read more about how to implement a custom node and its corresponding rule, see <a href="../inference/create-node/#create-node">Creating your own custom nodes</a> section.</p><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../variational/functional-forms/">« Functional form constraints</a><a class="docs-footer-nextpage" href="../inference/overview/">Overview »</a><div class="flexbox-break"></div><p class="footer-message">Created in <a href="https://biaslab.github.io/">BIASlab</a>, maintained by <a href="https://github.com/ReactiveBayes">ReactiveBayes</a>, powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 18 December 2025 21:03">Thursday 18 December 2025</span>. Using Julia version 1.12.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
