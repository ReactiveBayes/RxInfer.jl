<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Rule Not Found Error · RxInfer.jl</title><meta name="title" content="Rule Not Found Error · RxInfer.jl"/><meta property="og:title" content="Rule Not Found Error · RxInfer.jl"/><meta property="twitter:title" content="Rule Not Found Error · RxInfer.jl"/><meta name="description" content="Julia package for automated Bayesian inference on a factor graph with reactive message passing"/><meta property="og:description" content="Julia package for automated Bayesian inference on a factor graph with reactive message passing"/><meta property="twitter:description" content="Julia package for automated Bayesian inference on a factor graph with reactive message passing"/><meta property="og:url" content="https://docs.rxinfer.ml/stable/manuals/sharpbits/rule-not-found/"/><meta property="twitter:url" content="https://docs.rxinfer.ml/stable/manuals/sharpbits/rule-not-found/"/><link rel="canonical" href="https://docs.rxinfer.ml/stable/manuals/sharpbits/rule-not-found/"/><script async src="https://www.googletagmanager.com/gtag/js?id=G-X4PH160GMF"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X4PH160GMF', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/theme.css" rel="stylesheet" type="text/css"/><link href="../../../assets/header.css" rel="stylesheet" type="text/css"/><script src="../../../assets/header.js"></script><script src="../../../assets/chat.js"></script><link href="../../../assets/favicon.ico" rel="icon" type="image/x-icon"/><meta name="keywords" content="Julia, Bayesian inference, factor graph, message passing, probabilistic programming, reactive programming, RxInfer">
<link rel="sitemap" type="application/xml" title="Sitemap" href="https://docs.rxinfer.ml/stable/sitemap.xml"></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img class="docs-light-only" src="../../../assets/logo.svg" alt="RxInfer.jl logo"/><img class="docs-dark-only" src="../../../assets/logo-dark.svg" alt="RxInfer.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">RxInfer.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">User guide</span><ul><li><a class="tocitem" href="../../getting-started/">Getting started</a></li><li><a class="tocitem" href="../../comparison/">RxInfer.jl vs. Others</a></li><li><a class="tocitem" href="../../model-specification/">Model specification</a></li><li><a class="tocitem" href="../../constraints-specification/">Constraints specification</a></li><li><a class="tocitem" href="../../meta-specification/">Meta specification</a></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox"/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">Inference specification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../inference/overview/">Overview</a></li><li><a class="tocitem" href="../../inference/static/">Static inference</a></li><li><a class="tocitem" href="../../inference/streamlined/">Streamline inference</a></li><li><a class="tocitem" href="../../inference/initialization/">Initialization</a></li><li><a class="tocitem" href="../../inference/autoupdates/">Auto-updates</a></li><li><a class="tocitem" href="../../inference/delta-node/">Deterministic nodes</a></li><li><a class="tocitem" href="../../inference/nonconjugate/">Non-conjugate inference</a></li><li><a class="tocitem" href="../../inference/undefinedrules/">Undefined message update rules</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-7" type="checkbox"/><label class="tocitem" for="menuitem-2-7"><span class="docs-label">Inference customization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../customization/custom-node/">Defining a custom node and rules</a></li><li><a class="tocitem" href="../../customization/postprocess/">Inference results postprocessing</a></li></ul></li><li><a class="tocitem" href="../../debugging/">Debugging</a></li><li><a class="tocitem" href="../../session_summary/">Session summary</a></li><li><a class="tocitem" href="../../telemetry/">Sharing sessions &amp; telemetry</a></li><li><a class="tocitem" href="../../migration-guide-v2-v3/">Migration from v2 to v3</a></li><li><input class="collapse-toggle" id="menuitem-2-12" type="checkbox" checked/><label class="tocitem" for="menuitem-2-12"><span class="docs-label">Sharp bits of RxInfer</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../overview/">Overview</a></li><li class="is-active"><a class="tocitem" href>Rule Not Found Error</a><ul class="internal"><li><a class="tocitem" href="#Why-does-this-happen?"><span>Why does this happen?</span></a></li><li><a class="tocitem" href="#Common-scenarios"><span>Common scenarios</span></a></li><li><a class="tocitem" href="#Design-Philosophy"><span>Design Philosophy</span></a></li><li><a class="tocitem" href="#Visualizing-the-message-passing-graph"><span>Visualizing the message passing graph</span></a></li><li><a class="tocitem" href="#rule-not-found-solutions"><span>Solutions</span></a></li><li><a class="tocitem" href="#Implementation-details"><span>Implementation details</span></a></li></ul></li><li><a class="tocitem" href="../stack-overflow-inference/">Stack Overflow in Message Computations</a></li><li><a class="tocitem" href="../usage-colon-equality/">Using <code>=</code> instead of <code>:=</code> for deterministic nodes</a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../../library/model-construction/">Model construction</a></li><li><a class="tocitem" href="../../../library/bethe-free-energy/">Bethe Free Energy</a></li><li><a class="tocitem" href="../../../library/functional-forms/">Functional form constraints</a></li><li><a class="tocitem" href="../../../library/exported-methods/">Exported methods</a></li></ul></li><li><a class="tocitem" href="../../../examples/overview/">Examples</a></li><li><span class="tocitem">Contributing</span><ul><li><a class="tocitem" href="../../../contributing/guide/">Contribution guide</a></li><li><a class="tocitem" href="../../../contributing/guidelines/">Contribution guidelines</a></li><li><a class="tocitem" href="../../../contributing/new-documentation/">Contributing to the documentation</a></li><li><a class="tocitem" href="../../../contributing/new-example/">Contributing to the examples</a></li><li><a class="tocitem" href="../../../contributing/new-release/">Publishing a new release</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">User guide</a></li><li><a class="is-disabled">Sharp bits of RxInfer</a></li><li class="is-active"><a href>Rule Not Found Error</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Rule Not Found Error</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ReactiveBayes/RxInfer.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ReactiveBayes/RxInfer.jl/blob/main/docs/src/manuals/sharpbits/rule-not-found.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="rule-not-found"><a class="docs-heading-anchor" href="#rule-not-found">Rule Not Found Error</a><a id="rule-not-found-1"></a><a class="docs-heading-anchor-permalink" href="#rule-not-found" title="Permalink"></a></h1><p>When using RxInfer, you might encounter a <code>RuleNotFoundError</code>. This error occurs during message-passing inference when the system cannot find appropriate update rules for computing messages between nodes in your factor graph. Let&#39;s understand why this happens and how to resolve it.</p><h2 id="Why-does-this-happen?"><a class="docs-heading-anchor" href="#Why-does-this-happen?">Why does this happen?</a><a id="Why-does-this-happen?-1"></a><a class="docs-heading-anchor-permalink" href="#Why-does-this-happen?" title="Permalink"></a></h2><p>Message-passing inference works by exchanging messages between nodes in a factor graph. Each message represents a probability distribution, and the rules for computing these messages depend on:</p><ol><li>The type of the factor node (e.g., <code>Normal</code>, <code>Gamma</code>, etc.)</li><li>The types of incoming messages (e.g., <code>Normal</code>, <code>PointMass</code>, etc.) </li><li>The interface through which the message is being computed</li><li>The inference method being used (Belief Propagation or Variational Message Passing)</li></ol><p>The last point is particularly important - some message update rules may exist for Variational Message Passing (VMP) but not for Belief Propagation (BP), or vice versa. This is because BP aims to compute exact posterior distributions through message passing (when possible), while VMP approximates the posterior using the Bethe approximation. For a detailed mathematical treatment of these differences, see our <a href="../../../library/bethe-free-energy/#lib-bethe-free-energy">Bethe Free Energy implementation</a> guide.</p><p>For example, consider this simple model:</p><pre><code class="language-julia hljs">@model function problematic_model()
    μ ~ Normal(mean = 0.0, variance = 1.0)
    τ ~ Gamma(shape = 1.0, rate = 1.0)
    y ~ Normal(mean = μ, precision = τ)
end</code></pre><p>This model will fail with a <code>RuleNotFoundError</code> because there are no belief propagation message passing update rules available for this combination of distributions - only variational message passing rules exist. Even though the model looks simple, the message passing rules needed for exact inference do not exist in closed form.</p><h2 id="Common-scenarios"><a class="docs-heading-anchor" href="#Common-scenarios">Common scenarios</a><a id="Common-scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Common-scenarios" title="Permalink"></a></h2><p>You&#39;re likely to encounter this error when:</p><ol><li>Using non-conjugate pairs of distributions (e.g., <code>Beta</code> prior with <code>Normal</code> likelihood with precision parameterization)</li><li>Working with custom distributions or factor nodes without defining all necessary update rules</li><li>Using complex transformations between variables that don&#39;t have defined message computations</li><li>Mixing different types of distributions in ways that don&#39;t have analytical solutions</li></ol><h2 id="Design-Philosophy"><a class="docs-heading-anchor" href="#Design-Philosophy">Design Philosophy</a><a id="Design-Philosophy-1"></a><a class="docs-heading-anchor-permalink" href="#Design-Philosophy" title="Permalink"></a></h2><p>RxInfer prioritizes performance over generality in its message-passing implementation. By default, it only uses analytically derived message update rules, even in cases where numerical approximations might be possible. This design choice:</p><ul><li>Ensures fast and reliable inference when rules exist</li><li>Avoids potential numerical instabilities from approximations</li><li>Throws an error when analytical solutions don&#39;t exist</li></ul><p>This means you may encounter <code>RuleNotFoundError</code> even in cases where approximate solutions could theoretically work. This is intentional - RxInfer will tell you explicitly when you need to consider alternative approaches rather than silently falling back to potentially slower or less reliable approximations. See the <a href="#rule-not-found-solutions">Solutions</a> section below for more details.</p><h2 id="Visualizing-the-message-passing-graph"><a class="docs-heading-anchor" href="#Visualizing-the-message-passing-graph">Visualizing the message passing graph</a><a id="Visualizing-the-message-passing-graph-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing-the-message-passing-graph" title="Permalink"></a></h2><p>To better understand where message passing rules are needed, let&#39;s look at a simple factor graph visualization:</p><div class="mermaid">graph LR
    %% Other parts of the graph
    g1[g] -.-&gt; x
    h1[h] -.-&gt; z
    y -.-&gt; g2[p]
    
    %% Main focus area
    x((x)) -.- m1[[&quot;μ&lt;sub&gt;x→f&lt;/sub&gt;&quot;]] --&gt; f[f]
    f --&gt; m2[[&quot;μ&lt;sub&gt;f→y&lt;/sub&gt;&quot;]] -.- y((y))
    z((z)) -.- m3[[&quot;μ&lt;sub&gt;z→f&lt;/sub&gt;&quot;]] --&gt; f

    %% Styling
    classDef variable fill:#b3e0ff,stroke:#333,stroke-width:2px;
    classDef factor fill:#ff9999,stroke:#333,stroke-width:2px,shape:square;
    classDef otherFactor fill:#ff9999,stroke:#333,stroke-width:2px,opacity:0.3;
    classDef message fill:none,stroke:none;
    class x,y,z variable;
    class f factor;
    class g1,g2,h1 otherFactor;
    class m1,m2,m3 message;</div><p>In this example:</p><ul><li>Variables (<code>x</code>, <code>y</code>, <code>z</code>) are represented as circles</li><li>The factor node (<code>f</code>) is represented as a square</li><li>Messages (μ) flow along the edges between variables and factors, with subscripts indicating direction (e.g., x→f flows from x to f)</li><li>Faded nodes (g, h) represent other parts of the factor graph that aren&#39;t relevant for this local message computation</li></ul><p>To compute the outgoing message <code>f→y</code>, RxInfer needs:</p><ol><li>Rules for how to process incoming messages <code>x→f</code> and <code>z→f</code></li><li>Rules for combining these messages based on the factor <code>f</code>&#39;s type</li><li>Rules for producing the outgoing message type that <code>y</code> expects</li></ol><p>A <code>RuleNotFoundError</code> occurs when any of these rules are missing. For example, if <code>x</code> sends a <code>Normal</code> message but <code>f</code> doesn&#39;t know how to process <code>Normal</code> inputs, or if <code>f</code> can&#39;t produce the type of message that <code>y</code> expects.</p><h2 id="rule-not-found-solutions"><a class="docs-heading-anchor" href="#rule-not-found-solutions">Solutions</a><a id="rule-not-found-solutions-1"></a><a class="docs-heading-anchor-permalink" href="#rule-not-found-solutions" title="Permalink"></a></h2><h3 id="1.-Convert-to-conjugate-pairs"><a class="docs-heading-anchor" href="#1.-Convert-to-conjugate-pairs">1. Convert to conjugate pairs</a><a id="1.-Convert-to-conjugate-pairs-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Convert-to-conjugate-pairs" title="Permalink"></a></h3><p>First, try to reformulate your model using conjugate prior-likelihood pairs. Conjugate pairs have analytical solutions for message passing and are well-supported in RxInfer. For example, instead of using a <code>Normal</code> likelihood with <code>Beta</code> prior on its precision, use a <code>Normal-Gamma</code> conjugate pair. See <a href="https://en.wikipedia.org/wiki/Conjugate_prior#Table_of_conjugate_distributions">Conjugate prior - Wikipedia</a> for a comprehensive list of conjugate distributions.</p><h3 id="2.-Check-available-rules"><a class="docs-heading-anchor" href="#2.-Check-available-rules">2. Check available rules</a><a id="2.-Check-available-rules-1"></a><a class="docs-heading-anchor-permalink" href="#2.-Check-available-rules" title="Permalink"></a></h3><p>If conjugate pairs aren&#39;t suitable, verify if your combination of distributions and message types is supported. RxInfer provides many predefined rules, but not all combinations are possible. A good starting point is to check the <a href="https://reactivebayes.github.io/ReactiveMP.jl/stable/lib/nodes/#lib-predefined-nodes">List of available nodes</a> section in the documentation of ReactiveMP.jl.</p><h3 id="3.-Create-custom-update-rules"><a class="docs-heading-anchor" href="#3.-Create-custom-update-rules">3. Create custom update rules</a><a id="3.-Create-custom-update-rules-1"></a><a class="docs-heading-anchor-permalink" href="#3.-Create-custom-update-rules" title="Permalink"></a></h3><p>If you need specific message computations, you can define your own update rules. See <a href="../../customization/custom-node/#create-node">Creating your own custom nodes</a> for a detailed guide on implementing custom nodes and their update rules.</p><h3 id="4.-Use-approximations"><a class="docs-heading-anchor" href="#4.-Use-approximations">4. Use approximations</a><a id="4.-Use-approximations-1"></a><a class="docs-heading-anchor-permalink" href="#4.-Use-approximations" title="Permalink"></a></h3><p>When exact message updates aren&#39;t available, consider:</p><ul><li>Using simpler distribution pairs that have defined rules</li><li>Employing approximation techniques like moment matching or the methods described in <a href="../../meta-specification/#user-guide-meta-specification">Meta Specification</a> and <a href="../../inference/delta-node/#delta-node-manual">Deterministic nodes</a></li></ul><h3 id="5.-Use-variational-inference"><a class="docs-heading-anchor" href="#5.-Use-variational-inference">5. Use variational inference</a><a id="5.-Use-variational-inference-1"></a><a class="docs-heading-anchor-permalink" href="#5.-Use-variational-inference" title="Permalink"></a></h3><p>Sometimes, adding appropriate factorization constraints can help avoid problematic message computations:</p><pre><code class="language-julia hljs">constraints = @constraints begin
    q(μ, τ) = q(μ)q(τ)  # Mean-field assumption
end

result = infer(
    model = problematic_model(),
    constraints = constraints,
)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>When using variational constraints, you will likely need to initialize certain messages or marginals to handle loops in the factor graph. See <a href="../../inference/initialization/#initialization">Initialization</a> for details on how to properly initialize your model.</p></div></div><p>For more details on constraints and variational inference, see:</p><ul><li><a href="../../constraints-specification/#user-guide-constraints-specification">Constraints Specification</a> for a complete guide on using constraints</li><li><a href="../../../library/bethe-free-energy/#lib-bethe-free-energy">Bethe Free Energy</a> for the mathematical background on variational inference and message passing</li></ul><h2 id="Implementation-details"><a class="docs-heading-anchor" href="#Implementation-details">Implementation details</a><a id="Implementation-details-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-details" title="Permalink"></a></h2><p>When RxInfer encounters a missing rule, it means one of these is missing:</p><ol><li>A <code>@rule</code> definition for the specific message direction and types</li><li>A <code>@marginalrule</code> for computing joint marginals</li><li>An <code>@average_energy</code> implementation for free energy computation</li></ol><p>You can add these using the methods described in <a href="../../customization/custom-node/#create-node">Creating your own custom nodes</a>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Not all message-passing rules have analytical solutions. In such cases, you might need to use numerical approximations or choose different model structures.</p></div></div><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../overview/">« Overview</a><a class="docs-footer-nextpage" href="../stack-overflow-inference/">Stack Overflow in Message Computations »</a><div class="flexbox-break"></div><p class="footer-message">Created in <a href="https://biaslab.github.io/">BIASlab</a>, maintained by <a href="https://github.com/ReactiveBayes">ReactiveBayes</a>, powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Wednesday 26 February 2025 13:31">Wednesday 26 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
